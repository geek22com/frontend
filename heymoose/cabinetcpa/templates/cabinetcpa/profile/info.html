{% extends "cabinetcpa/profile/layout.html" %}

{% set activetab = 'info' %}

{% block extrahead %}
	{{ super() }}
	<style type="text/css">
		.code-box, .code-box[readonly] {
			background-color: #FFF;
			cursor: text;
		}
	</style>
	<script type="text/javascript">
		$(function() {
			var refLink = "{{ url_for('site.register_affiliate', ref=g.user.get_refcode(), _external=true) -}}";
			$('.gen-trigger').change(function() {
				var source = $.trim($('#source').val());
				$('#reflink-url').text(refLink + (source ? '&source=' + encodeURIComponent(source) : ''));
			}).change();
		})
	</script>
{% endblock %}

{% block tabcontent %}
{% with user = g.user %}

{% if user.blocked %}
	<div class="clearfix alert-message block-message error">
		<p>
			<strong>Учетная запись заблокирована.</strong>
			Ваш аккаунт был заблокирован администрацией &laquo;HeyMoose!&raquo;, поэтому
			вам недоступна большая часть интерфейса системы.
		</p>
		{% if user.block_reason %}
		<p>Причина блокировки: <i>{{ user.block_reason }}</i></p>
		{% endif %}
	</div>
{% endif %}

<table class="key-value">
	<tbody>
		<tr><th>Имя</th><td>{{ user.full_name|default('(не указано)', true) }}</td></tr>
		<tr><th>Организация</th><td>{{ user.organization|default('(не указана)', true) }}</td></tr>
		{% if user.is_affiliate %}
		<tr><th>WMR-кошелёк</th><td>{{ user.wmr|default('(не указан)', true) }}</td></tr>
		{% endif %}
	</tbody>
</table>

<h3>Контакты</h3>
<table class="key-value">
	<tbody>
		<tr><th>E-mail</th><td>{{ user.email }}</td></tr>
		<tr><th>Телефон</th><td>{{ user.phone|default('(не указан)', true) }}</td></tr>
		<tr>
			<th>Мессенджер</th>
			<td>
				{% if user.messenger_type %}
				{{ user.messenger_uid }} ({{ user.messenger_type }})
				{% else %}
				(не указан)
				{% endif %}
			</td>
		</tr>
	</tbody>
</table>

{% if user.is_affiliate %}
<h3>Реферальная программа</h3>
<table class="key-value">
	<tbody>
		{% with ref = url_for('site.register_affiliate', ref=user.get_refcode(), _external=true) %}
		<tr>
			<th>Реферальная ссылка</th>
			<td>
				<a href="#" data-controls-modal="modal-reflink" data-backdrop="true" data-keyboard="true">получить</a>
				<div id="modal-reflink" class="modal" style="display: none;">
					<div class="modal-header">
						<a href="#" class="close">×</a>
						<h3>Реферальная ссылка</h3>
					</div>
					<div class="modal-body">
						<form class="stacked">
							<div class="clearfix">
								<label for="source">Источник</label>
								<input type="text" id="source" class="source span4 gen-trigger" />
								<span class="help-block">
									Поле "Источник" позволяет разделять статистику по рефералам,
									пришедшим с разных мест размещения реферальной ссылки.
								</span>
							</div>
							<div class="clearfix">
								<label for="reflink-url">Ссылка</label>
								<textarea rows="3" id="reflink-url" class="span9 code-box" readonly="readonly"></textarea>
							</div>
						</form>
					</div>
				</div>
			</td>
		</tr>
		{% endwith %}
		<tr>
			<th>Рефералы</th>
			<td><a href="{{ url_for('.stats_referral') }}">список рефералов</a></td>
		</tr>
	</tbody>
</table>
{% endif %}

<h3>Сервисы</h3>
<table class="key-value">
	<tbody>
		<tr><th>Регистрационный код к <a href="http://forum.heymoose.com" target="_blank">форуму</a></th><td>8675309</td></tr>
	</tbody>
</table>


{% endwith %}
{% endblock %}
