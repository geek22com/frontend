{% extends "cabinetcpa/layout.html" %}

{% block title %}Главная{% endblock %}

{% set activemenu = 'index' %}

{% block breadcrumbs %}
	{{ super() }}
	{{ macros.breadcrumb('Главная', url_for('.index')) }}
{% endblock %}

{% block extrahead %}
	{{ super() }}
	<style type="text/css">
		.hot-links li {
			line-height: 24px;
		}
		
		.more-link {
			float: right;
			font-size: 13px;
			font-weight: normal;
		}
		
		.notes-list dd {
			margin-bottom: 10px;
		}
		
		.newsitem-wrap {
			overflow-y: auto;
			max-height: 400px;
		}
	</style>
{% endblock %}

{% block precontent %}
	{% if not g.user.confirmed or not g.user.wmr or not has_sites or not has_placements %}
		<div class="clearfix alert-message block-message success" style="background-color: #BFE7BF;">
			<h2>Добро пожаловать в систему HeyMoose!</h2>
			<p>
				<strong>Для того, чтобы начать пользоваться системой, Вам осталось проделать несколько простых действий:</strong>
			</p>
			{% if not g.user.confirmed %}
			<div class="clearfix alert-message block-message success">
				<p>
					Пожалуйста, подтвердите Ваш почтовый ящик. Если почтовый ящик не будет подтвержден в течение двух недель, Ваша учетная запись будет заблокирована. Если Вы не получили письмо со ссылкой на подтверждение регистрации, Вы можете запросить повторную отправку письма, нажав кнопку ниже.
				</p>
				<div class="alert-actions right">
					<a href="{{ url_for('.profile_sendmail') }}" class="btn small span4 center">Выслать письмо повторно</a>
				</div>
			</div>
			{% endif %}
			{% if not g.user.wmr %}
			<div class="clearfix alert-message block-message success">
				<p>
					Для совершения выплат нам необходим номер вашего WMR-кошелька в системе WebMoney. Пожалуйста, заполните его в Вашем профиле. Чтобы перейти к редактированию профиля, нажмите кнопку ниже.
				</p>
				<div class="alert-actions right">
					<a class="btn small span4 center" href="{{ url_for('.profile_edit') }}">Ввести номер WMR-кошелька</a>
				</div>
			</div>
			{% endif %}
			{% if not has_sites %}
			<div class="clearfix alert-message block-message success">
				<p>
					Зарегистрируйте в системе одну из Ваших площадок или другой способ продвижения Вами рекламных предложений. В дальнейшем Вы сможете просматривать статистику по Вашим площадкам, и видеть, какая из них приносит Вам больший доход.
				</p>
				<div class="alert-actions right">
					<a class="btn small span4 center" href="{{ url_for('.sites_new') }}">Добавить площадку</a>
				</div>
			</div>
			{% elif not has_placements %}
			<div class="clearfix alert-message block-message success">
				<p>
					Выберите одно из рекламных предложений в нашем каталоге офферов, и создайте размещение этого оффера на одной из созданных Вами площадок. Размещение позволит Вам сгенерировать партнерскую ссылку, ведущую на сайт рекламодателя, с помощью которой мы будем отслеживать пользователей, перешедших с Вашей рекламной площадки.
				</p>
				<div class="alert-actions right">
					<a class="btn small span4 center" href="{{ url_for('.offers_all') }}">Перейти в каталог офферов</a>
				</div>
			</div>
			{% endif %}
		</div>
	{% endif %}
{% endblock %}

{% block content %}
	{% if referral_offer %}
		{# Pixel for referral offer #}
		{% with api_url = config.get('TRACKER_API_URL') %}
		<img src="{{ api_url -}}?method=reportAction&transaction_id={{ g.user.id -}}&advertiser_id={{ referral_offer.advertiser.id -}}&offer={{ referral_offer.code -}}"
		alt="" style="width: 0; height: 0; position: absolute;" />
		{% endwith %}
	{% endif %}

	<div class="row">
		<div class="span4">
			<div class="page-header">
				<h5>Быстрые ссылки</h5>
			</div>
			<ul class="hot-links">
				<li><strong><a href="{{ url_for('.offers_all') }}">Каталог офферов</a></strong></li>
				<li><strong><a href="{{ url_for('.offers_products') }}">Каталог товаров</a></strong></li>
				<li><a href="{{ url_for('.offers_requested') }}">Мои офферы</a></li>
				<li><a href="{{ url_for('.sites_list') }}">Мои площадки</a></li>
				<li><a href="{{ url_for('.stats_offer') }}">Моя статистика</a></li>
				<li><a href="{{ url_for('.withdrawals') }}">Мои выплаты</a></li>
				<li><a href="{{ url_for('.notifications') }}">Мои уведомления</a></li>
				<li><a href="{{ url_for('.profile') }}">Мой профиль</a></li>
			</ul>
		</div>
		<div class="span11">
			<h5>
				Лучшие офферы за месяц
				<a href="{{ url_for('.stats_offer') }}" class="more-link">подробно &raquo;</a>
			</h5>
			{% if offer_stats %}
			<table class="bordered-table zebra-striped condensed-table nosort">
				<thead>
					<tr>
						<th class="header center" rowspan="2">Оффер</th>
						<th class="header center" rowspan="2">Клики</th>
						<th class="header center" rowspan="2">Действия</th>
						<th class="header center" rowspan="2">CR</th>
						<th class="header center" colspan="2">Финансы, руб.</th>
					</tr>
					<tr class="subrow">
						<th class="header center">Неподтв.</th>
						<th class="header center">Подтв.</th>
					</tr>
				</thead>
				<tbody>
					{% for stat in offer_stats %}
					<tr>
						<td><a href="{{ url_for('.offers_info', id=stat.id) }}">{{ stat.name }}</a></td>
						<td class="right">{{ stat.clicks }}</td>
						<td class="right">{{ stat.leads }}</td>
						<td class="right">{% if stat.cr %}{{ stat.cr if stat.cr <= 100 else 'более&nbsp;100'|safe -}}&nbsp;%{% else %}&mdash;{% endif %}</td>
						<td class="right">{{ stat.not_confirmed_revenue }}</td>
						<td class="right green">{{ stat.confirmed_revenue }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
			{% else %}
			<div class="clearfix alert-message block-message info">
				<p>
					{% if has_placements %}
					<strong>Нет данных.</strong> За месяц не было активности с вашей стороны по
					рекламным кампаниям. Посетите наш каталог и выберите лучшие предложения
					для сотрудничества.
					{% else %}
					<strong>Нет данных.</strong> Вы еще не подключили ни одной рекламной кампании.
					Посетите наш каталог и выберите лучшие предложения для сотрудничества.
					{% endif %}
				</p>
				<div class="alert-actions">
					<a class="btn small" href="{{ url_for('.offers_all') }}">Перейти в каталог рекламных предложений</a>
				</div>
			</div>
			{% endif %}

			<h5>
				Лучшие площадки за месяц
				<a href="{{ url_for('.stats_site') }}" class="more-link">подробно &raquo;</a>
			</h5>
			{% if site_stats %}
			<table class="bordered-table zebra-striped condensed-table nosort">
				<thead>
					<tr>
						<th class="header center" rowspan="2">Площадка</th>
						<th class="header center" rowspan="2">Клики</th>
						<th class="header center" rowspan="2">Действия</th>
						<th class="header center" rowspan="2">CR</th>
						<th class="header center" colspan="2">Финансы, руб.</th>
					</tr>
					<tr class="subrow">
						<th class="header center">Неподтв.</th>
						<th class="header center">Подтв.</th>
					</tr>
				</thead>
				<tbody>
					{% for stat in site_stats %}
					<tr>
						<td><a href="{{ url_for('.sites_info', id=stat.id) }}">{{ stat.name }}</a></td>
						<td class="right">{{ stat.clicks }}</td>
						<td class="right">{{ stat.leads }}</td>
						<td class="right">{% if stat.cr %}{{ stat.cr if stat.cr <= 100 else 'более&nbsp;100'|safe -}}&nbsp;%{% else %}&mdash;{% endif %}</td>
						<td class="right">{{ stat.not_confirmed_revenue }}</td>
						<td class="right green">{{ stat.confirmed_revenue }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
			{% else %}
			<div class="clearfix alert-message block-message info">
				<p>
					{% if has_sites %}
					<strong>Нет данных.</strong> За месяц не было активности по Вашим рекламным площадкам.
					{% else %}
					<strong>Нет данных.</strong> Вы еще не зарегистрировали в системе ни одной площадки.
					{% endif %}
				</p>
				<div class="alert-actions">
					<a class="btn small" href="{{ url_for('.sites_new') }}">Добавить рекламную площадку</a>
				</div>
			</div>
			{% endif %}
		</div>
	</div>
	<div class="row">
		<div class="span7">
			<div class="page-header">
				<h5>Последние новости</h5>
			</div>
			{% if news %}
			<dl class="notes-list">
				{% for newsitem in news %}
				<dt>
					{{ newsitem.date|dateformat }} &mdash;
					<a href="#" data-controls-modal="newsitem-{{ newsitem.mongo_id -}}"
					 data-backdrop="true" data-keyboard="true">{{ newsitem.title }}</a>
					<div class="modal fade" id="newsitem-{{ newsitem.mongo_id }}" style="display: none;">
						<div class="modal-header">
							<a href="#" class="close">×</a>
							<h3>{{ newsitem.date|dateformat }} &mdash; {{ newsitem.title }}</h3>
						</div>
						<div class="modal-body">
							<div class="newsitem-wrap redactor-text">
								{{ newsitem.text|safe }}
							</div>
						</div>
					</div>
				</dt>
				<dd>{{ newsitem.summary|safe }}</dd>
				{% endfor %}
			</dl>
			{% else %}
			<div class="clearfix alert-message block-message info">
				<p>Новостей нет.</p>
			</div>
			{% endif %}
		</div>
		<div class="span7" style="margin-left: 80px;">
			<div class="page-header">
				<h5>
					Последние уведомления
					<a href="{{ url_for('.notifications') }}" class="more-link">подробно &raquo;</a>
				</h5>
			</div>
			
			{% if notifications %}
			<dl class="notes-list">
				{% for notification in notifications %}
				<dt>{{ notification.date|datetimeformat }}</dt>
				<dd>{{ notification.body|safe }}</dd>
				{% endfor %}
			</dl>
			{% else %}
			<div class="clearfix alert-message block-message info">
				<p>Не было ни одного уведомления.</p>
			</div>
			{% endif %}
		</div>
	</div>
	<div class="disqus-wrap">
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'heymoose'; // required: replace example with your forum shortname
			var disqus_identifier = 'cabinet';

			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	</div>
{% endblock %}
