{% extends "admin/orders-layout.html" %}

{% set activetab = 'list' %}

{% block extrahead %}
	{{ super() }}
	<script type="text/javascript">
		$(function() {
			var urlEnable = "{{ url_for('.ajax_orders_enable', id=0) }}";
			var urlDisable = "{{ url_for('.ajax_orders_disable', id=0) }}";
			
			$('input.cbx-enabled').change(function(e) {
				var $cbx = $(this);
				var checked = $cbx.is(':checked');
				var id = $cbx.attr('rel');
				var url = (checked ? urlEnable : urlDisable).replace('0', id);
				
				$cbx.attr('disabled', 'disabled');
				$.post(url).error(function(xhr) {
					if (checked) $cbx.removeAttr('checked');
					else $cbx.attr('checked', 'checked');
					alert('Ошибка ' + xhr.status + ': ' + xhr.responseText);
				});
				$cbx.removeAttr('disabled');
			});
		})
	</script>
{% endblock %}

{% block tabcontent %}

{% if orders %}
	<table class="bordered-table zebra-striped">
		<thead>
			<tr>
				<th class="header right">ИД</th>
				<th class="header">Название</th>
				<th class="header">Тип</th>
				<th class="header">Заказчик</th>
				<th class="header right">Баланс</th>
				<th class="header right">CPA</th>
				<th class="header center">Пол</th>
				<th class="header">Возраст</th>
				<th class="header center">Создан</th>
				<th class="header center">Активен</th>
			</tr>
		</thead>
		<tbody>
			{% for order in orders %}
			<tr>
				<td class="right">{{ order.id }}</td>
				<td>{{ macros.order_href(order) }}</td>
				<td>{{ macros.order_type(order.type) }}</td>
				<td>{{ macros.user_href(order.user) }}</td>
				<td class="right">{{ order.balance }}</td>
				<td class="right">{{ order.cpa }}</td>
				<td>{{ macros.order_gender(order.male)}}</td>
				<td>{{ macros.order_age(order.min_age, order.max_age) }}</td>
				<td class="center">{{ order.creation_time|datetimeformat }}</td>
				{#<td class="center">{{ macros.to_icon(not order.disabled) }}</td>#}
				<td class="center">
					<input type="checkbox" class="cbx-enabled"
						{% if not order.disabled %}checked="checked"{% endif %}
						rel="{{ order.id }}"
					/>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{{ macros.paginate(pages, '.orders') }}
{% else %}
	<div class="clearfix alert-message block-message info">
		<p><strong>Список пуст.</strong> Еще не было создано ни одного заказа.</p>
	</div>
{% endif %}

{% endblock %}
